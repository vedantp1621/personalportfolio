{"ast":null,"code":"import { transformedNormalView } from '../../accessors/NormalNode.js';\nimport { positionViewDirection } from '../../accessors/PositionNode.js';\nimport { sheen, sheenRoughness } from '../../core/PropertyNode.js';\nimport { tslFn, float } from '../../shadernode/ShaderNode.js';\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nconst D_Charlie = tslFn(_ref => {\n  let {\n    roughness,\n    dotNH\n  } = _ref;\n  const alpha = roughness.pow2();\n\n  // Estevez and Kulla 2017, \"Production Friendly Microfacet Sheen BRDF\"\n  const invAlpha = float(1.0).div(alpha);\n  const cos2h = dotNH.pow2();\n  const sin2h = cos2h.oneMinus().max(0.0078125); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\n  return float(2.0).add(invAlpha).mul(sin2h.pow(invAlpha.mul(0.5))).div(2.0 * Math.PI);\n}).setLayout({\n  name: 'D_Charlie',\n  type: 'float',\n  inputs: [{\n    name: 'roughness',\n    type: 'float'\n  }, {\n    name: 'dotNH',\n    type: 'float'\n  }]\n});\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nconst V_Neubelt = tslFn(_ref2 => {\n  let {\n    dotNV,\n    dotNL\n  } = _ref2;\n  // Neubelt and Pettineo 2013, \"Crafting a Next-gen Material Pipeline for The Order: 1886\"\n  return float(1.0).div(float(4.0).mul(dotNL.add(dotNV).sub(dotNL.mul(dotNV))));\n}).setLayout({\n  name: 'V_Neubelt',\n  type: 'float',\n  inputs: [{\n    name: 'dotNV',\n    type: 'float'\n  }, {\n    name: 'dotNL',\n    type: 'float'\n  }]\n});\nconst BRDF_Sheen = tslFn(_ref3 => {\n  let {\n    lightDirection\n  } = _ref3;\n  const halfDir = lightDirection.add(positionViewDirection).normalize();\n  const dotNL = transformedNormalView.dot(lightDirection).clamp();\n  const dotNV = transformedNormalView.dot(positionViewDirection).clamp();\n  const dotNH = transformedNormalView.dot(halfDir).clamp();\n  const D = D_Charlie({\n    roughness: sheenRoughness,\n    dotNH\n  });\n  const V = V_Neubelt({\n    dotNV,\n    dotNL\n  });\n  return sheen.mul(D).mul(V);\n});\nexport default BRDF_Sheen;","map":{"version":3,"names":["transformedNormalView","positionViewDirection","sheen","sheenRoughness","tslFn","float","D_Charlie","_ref","roughness","dotNH","alpha","pow2","invAlpha","div","cos2h","sin2h","oneMinus","max","add","mul","pow","Math","PI","setLayout","name","type","inputs","V_Neubelt","_ref2","dotNV","dotNL","sub","BRDF_Sheen","_ref3","lightDirection","halfDir","normalize","dot","clamp","D","V"],"sources":["/Users/vedant/node_modules/three/examples/jsm/nodes/functions/BSDF/BRDF_Sheen.js"],"sourcesContent":["import { transformedNormalView } from '../../accessors/NormalNode.js';\nimport { positionViewDirection } from '../../accessors/PositionNode.js';\nimport { sheen, sheenRoughness } from '../../core/PropertyNode.js';\nimport { tslFn, float } from '../../shadernode/ShaderNode.js';\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nconst D_Charlie = tslFn( ( { roughness, dotNH } ) => {\n\n\tconst alpha = roughness.pow2();\n\n\t// Estevez and Kulla 2017, \"Production Friendly Microfacet Sheen BRDF\"\n\tconst invAlpha = float( 1.0 ).div( alpha );\n\tconst cos2h = dotNH.pow2();\n\tconst sin2h = cos2h.oneMinus().max( 0.0078125 ); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\n\treturn float( 2.0 ).add( invAlpha ).mul( sin2h.pow( invAlpha.mul( 0.5 ) ) ).div( 2.0 * Math.PI );\n\n} ).setLayout( {\n\tname: 'D_Charlie',\n\ttype: 'float',\n\tinputs: [\n\t\t{ name: 'roughness', type: 'float' },\n\t\t{ name: 'dotNH', type: 'float' }\n\t]\n} );\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nconst V_Neubelt = tslFn( ( { dotNV, dotNL } ) => {\n\n\t// Neubelt and Pettineo 2013, \"Crafting a Next-gen Material Pipeline for The Order: 1886\"\n\treturn float( 1.0 ).div( float( 4.0 ).mul( dotNL.add( dotNV ).sub( dotNL.mul( dotNV ) ) ) );\n\n} ).setLayout( {\n\tname: 'V_Neubelt',\n\ttype: 'float',\n\tinputs: [\n\t\t{ name: 'dotNV', type: 'float' },\n\t\t{ name: 'dotNL', type: 'float' }\n\t]\n} );\n\nconst BRDF_Sheen = tslFn( ( { lightDirection } ) => {\n\n\tconst halfDir = lightDirection.add( positionViewDirection ).normalize();\n\n\tconst dotNL = transformedNormalView.dot( lightDirection ).clamp();\n\tconst dotNV = transformedNormalView.dot( positionViewDirection ).clamp();\n\tconst dotNH = transformedNormalView.dot( halfDir ).clamp();\n\n\tconst D = D_Charlie( { roughness: sheenRoughness, dotNH } );\n\tconst V = V_Neubelt( { dotNV, dotNL } );\n\n\treturn sheen.mul( D ).mul( V );\n\n} );\n\nexport default BRDF_Sheen;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}