{"ast":null,"code":"import Node, { addNodeClass } from '../core/Node.js';\nimport { arrayBufferToBase64, base64ToArrayBuffer } from '../core/NodeUtils.js';\nimport { addNodeElement, nodeProxy, float } from '../shadernode/ShaderNode.js';\nimport { EventDispatcher } from 'three';\nclass ScriptableValueNode extends Node {\n  constructor() {\n    let value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    super();\n    this._value = value;\n    this._cache = null;\n    this.inputType = null;\n    this.outpuType = null;\n    this.events = new EventDispatcher();\n    this.isScriptableValueNode = true;\n  }\n  get isScriptableOutputNode() {\n    return this.outputType !== null;\n  }\n  set value(val) {\n    if (this._value === val) return;\n    if (this._cache && this.inputType === 'URL' && this.value.value instanceof ArrayBuffer) {\n      URL.revokeObjectURL(this._cache);\n      this._cache = null;\n    }\n    this._value = val;\n    this.events.dispatchEvent({\n      type: 'change'\n    });\n    this.refresh();\n  }\n  get value() {\n    return this._value;\n  }\n  refresh() {\n    this.events.dispatchEvent({\n      type: 'refresh'\n    });\n  }\n  getValue() {\n    const value = this.value;\n    if (value && this._cache === null && this.inputType === 'URL' && value.value instanceof ArrayBuffer) {\n      this._cache = URL.createObjectURL(new Blob([value.value]));\n    } else if (value && value.value !== null && value.value !== undefined && ((this.inputType === 'URL' || this.inputType === 'String') && typeof value.value === 'string' || this.inputType === 'Number' && typeof value.value === 'number' || this.inputType === 'Vector2' && value.value.isVector2 || this.inputType === 'Vector3' && value.value.isVector3 || this.inputType === 'Vector4' && value.value.isVector4 || this.inputType === 'Color' && value.value.isColor || this.inputType === 'Matrix3' && value.value.isMatrix3 || this.inputType === 'Matrix4' && value.value.isMatrix4)) {\n      return value.value;\n    }\n    return this._cache || value;\n  }\n  getNodeType(builder) {\n    return this.value && this.value.isNode ? this.value.getNodeType(builder) : 'float';\n  }\n  setup() {\n    return this.value && this.value.isNode ? this.value : float();\n  }\n  serialize(data) {\n    super.serialize(data);\n    if (this.value !== null) {\n      if (this.inputType === 'ArrayBuffer') {\n        data.value = arrayBufferToBase64(this.value);\n      } else {\n        data.value = this.value ? this.value.toJSON(data.meta).uuid : null;\n      }\n    } else {\n      data.value = null;\n    }\n    data.inputType = this.inputType;\n    data.outputType = this.outputType;\n  }\n  deserialize(data) {\n    super.deserialize(data);\n    let value = null;\n    if (data.value !== null) {\n      if (data.inputType === 'ArrayBuffer') {\n        value = base64ToArrayBuffer(data.value);\n      } else if (data.inputType === 'Texture') {\n        value = data.meta.textures[data.value];\n      } else {\n        value = data.meta.nodes[data.value] || null;\n      }\n    }\n    this.value = value;\n    this.inputType = data.inputType;\n    this.outputType = data.outputType;\n  }\n}\nexport default ScriptableValueNode;\nexport const scriptableValue = nodeProxy(ScriptableValueNode);\naddNodeElement('scriptableValue', scriptableValue);\naddNodeClass('ScriptableValueNode', ScriptableValueNode);","map":{"version":3,"names":["Node","addNodeClass","arrayBufferToBase64","base64ToArrayBuffer","addNodeElement","nodeProxy","float","EventDispatcher","ScriptableValueNode","constructor","value","arguments","length","undefined","_value","_cache","inputType","outpuType","events","isScriptableValueNode","isScriptableOutputNode","outputType","val","ArrayBuffer","URL","revokeObjectURL","dispatchEvent","type","refresh","getValue","createObjectURL","Blob","isVector2","isVector3","isVector4","isColor","isMatrix3","isMatrix4","getNodeType","builder","isNode","setup","serialize","data","toJSON","meta","uuid","deserialize","textures","nodes","scriptableValue"],"sources":["/Users/vedant/node_modules/three/examples/jsm/nodes/code/ScriptableValueNode.js"],"sourcesContent":["import Node, { addNodeClass } from '../core/Node.js';\nimport { arrayBufferToBase64, base64ToArrayBuffer } from '../core/NodeUtils.js';\nimport { addNodeElement, nodeProxy, float } from '../shadernode/ShaderNode.js';\nimport { EventDispatcher } from 'three';\n\nclass ScriptableValueNode extends Node {\n\n\tconstructor( value = null ) {\n\n\t\tsuper();\n\n\t\tthis._value = value;\n\t\tthis._cache = null;\n\n\t\tthis.inputType = null;\n\t\tthis.outpuType = null;\n\n\t\tthis.events = new EventDispatcher();\n\n\t\tthis.isScriptableValueNode = true;\n\n\t}\n\n\tget isScriptableOutputNode() {\n\n\t\treturn this.outputType !== null;\n\n\t}\n\n\tset value( val ) {\n\n\t\tif ( this._value === val ) return;\n\n\t\tif ( this._cache && this.inputType === 'URL' && this.value.value instanceof ArrayBuffer ) {\n\n\t\t\tURL.revokeObjectURL( this._cache );\n\n\t\t\tthis._cache = null;\n\n\t\t}\n\n\t\tthis._value = val;\n\n\t\tthis.events.dispatchEvent( { type: 'change' } );\n\n\t\tthis.refresh();\n\n\t}\n\n\tget value() {\n\n\t\treturn this._value;\n\n\t}\n\n\trefresh() {\n\n\t\tthis.events.dispatchEvent( { type: 'refresh' } );\n\n\t}\n\n\tgetValue() {\n\n\t\tconst value = this.value;\n\n\t\tif ( value && this._cache === null && this.inputType === 'URL' && value.value instanceof ArrayBuffer ) {\n\n\t\t\tthis._cache = URL.createObjectURL( new Blob( [ value.value ] ) );\n\n\t\t} else if ( value && value.value !== null && value.value !== undefined && (\n\t\t\t( ( this.inputType === 'URL' || this.inputType === 'String' ) && typeof value.value === 'string' ) ||\n\t\t\t( this.inputType === 'Number' && typeof value.value === 'number' ) ||\n\t\t\t( this.inputType === 'Vector2' && value.value.isVector2 ) ||\n\t\t\t( this.inputType === 'Vector3' && value.value.isVector3 ) ||\n\t\t\t( this.inputType === 'Vector4' && value.value.isVector4 ) ||\n\t\t\t( this.inputType === 'Color' && value.value.isColor ) ||\n\t\t\t( this.inputType === 'Matrix3' && value.value.isMatrix3 ) ||\n\t\t\t( this.inputType === 'Matrix4' && value.value.isMatrix4 )\n\t\t) ) {\n\n\t\t\treturn value.value;\n\n\t\t}\n\n\t\treturn this._cache || value;\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\treturn this.value && this.value.isNode ? this.value.getNodeType( builder ) : 'float';\n\n\t}\n\n\tsetup() {\n\n\t\treturn this.value && this.value.isNode ? this.value : float();\n\n\t}\n\n\tserialize( data ) {\n\n\t\tsuper.serialize( data );\n\n\t\tif ( this.value !== null ) {\n\n\t\t\tif ( this.inputType === 'ArrayBuffer' ) {\n\n\t\t\t\tdata.value = arrayBufferToBase64( this.value );\n\n\t\t\t} else {\n\n\t\t\t\tdata.value = this.value ? this.value.toJSON( data.meta ).uuid : null;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tdata.value = null;\n\n\t\t}\n\n\t\tdata.inputType = this.inputType;\n\t\tdata.outputType = this.outputType;\n\n\t}\n\n\tdeserialize( data ) {\n\n\t\tsuper.deserialize( data );\n\n\t\tlet value = null;\n\n\t\tif ( data.value !== null ) {\n\n\t\t\tif ( data.inputType === 'ArrayBuffer' ) {\n\n\t\t\t\tvalue = base64ToArrayBuffer( data.value );\n\n\t\t\t} else if ( data.inputType === 'Texture' ) {\n\n\t\t\t\tvalue = data.meta.textures[ data.value ];\n\n\t\t\t} else {\n\n\t\t\t\tvalue = data.meta.nodes[ data.value ] || null;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.value = value;\n\n\t\tthis.inputType = data.inputType;\n\t\tthis.outputType = data.outputType;\n\n\t}\n\n}\n\nexport default ScriptableValueNode;\n\nexport const scriptableValue = nodeProxy( ScriptableValueNode );\n\naddNodeElement( 'scriptableValue', scriptableValue );\n\naddNodeClass( 'ScriptableValueNode', ScriptableValueNode );\n"],"mappings":"AAAA,OAAOA,IAAI,IAAIC,YAAY,QAAQ,iBAAiB;AACpD,SAASC,mBAAmB,EAAEC,mBAAmB,QAAQ,sBAAsB;AAC/E,SAASC,cAAc,EAAEC,SAAS,EAAEC,KAAK,QAAQ,6BAA6B;AAC9E,SAASC,eAAe,QAAQ,OAAO;AAEvC,MAAMC,mBAAmB,SAASR,IAAI,CAAC;EAEtCS,WAAWA,CAAA,EAAiB;IAAA,IAAfC,KAAK,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,IAAI;IAExB,KAAK,CAAC,CAAC;IAEP,IAAI,CAACG,MAAM,GAAGJ,KAAK;IACnB,IAAI,CAACK,MAAM,GAAG,IAAI;IAElB,IAAI,CAACC,SAAS,GAAG,IAAI;IACrB,IAAI,CAACC,SAAS,GAAG,IAAI;IAErB,IAAI,CAACC,MAAM,GAAG,IAAIX,eAAe,CAAC,CAAC;IAEnC,IAAI,CAACY,qBAAqB,GAAG,IAAI;EAElC;EAEA,IAAIC,sBAAsBA,CAAA,EAAG;IAE5B,OAAO,IAAI,CAACC,UAAU,KAAK,IAAI;EAEhC;EAEA,IAAIX,KAAKA,CAAEY,GAAG,EAAG;IAEhB,IAAK,IAAI,CAACR,MAAM,KAAKQ,GAAG,EAAG;IAE3B,IAAK,IAAI,CAACP,MAAM,IAAI,IAAI,CAACC,SAAS,KAAK,KAAK,IAAI,IAAI,CAACN,KAAK,CAACA,KAAK,YAAYa,WAAW,EAAG;MAEzFC,GAAG,CAACC,eAAe,CAAE,IAAI,CAACV,MAAO,CAAC;MAElC,IAAI,CAACA,MAAM,GAAG,IAAI;IAEnB;IAEA,IAAI,CAACD,MAAM,GAAGQ,GAAG;IAEjB,IAAI,CAACJ,MAAM,CAACQ,aAAa,CAAE;MAAEC,IAAI,EAAE;IAAS,CAAE,CAAC;IAE/C,IAAI,CAACC,OAAO,CAAC,CAAC;EAEf;EAEA,IAAIlB,KAAKA,CAAA,EAAG;IAEX,OAAO,IAAI,CAACI,MAAM;EAEnB;EAEAc,OAAOA,CAAA,EAAG;IAET,IAAI,CAACV,MAAM,CAACQ,aAAa,CAAE;MAAEC,IAAI,EAAE;IAAU,CAAE,CAAC;EAEjD;EAEAE,QAAQA,CAAA,EAAG;IAEV,MAAMnB,KAAK,GAAG,IAAI,CAACA,KAAK;IAExB,IAAKA,KAAK,IAAI,IAAI,CAACK,MAAM,KAAK,IAAI,IAAI,IAAI,CAACC,SAAS,KAAK,KAAK,IAAIN,KAAK,CAACA,KAAK,YAAYa,WAAW,EAAG;MAEtG,IAAI,CAACR,MAAM,GAAGS,GAAG,CAACM,eAAe,CAAE,IAAIC,IAAI,CAAE,CAAErB,KAAK,CAACA,KAAK,CAAG,CAAE,CAAC;IAEjE,CAAC,MAAM,IAAKA,KAAK,IAAIA,KAAK,CAACA,KAAK,KAAK,IAAI,IAAIA,KAAK,CAACA,KAAK,KAAKG,SAAS,KACnE,CAAE,IAAI,CAACG,SAAS,KAAK,KAAK,IAAI,IAAI,CAACA,SAAS,KAAK,QAAQ,KAAM,OAAON,KAAK,CAACA,KAAK,KAAK,QAAQ,IAC9F,IAAI,CAACM,SAAS,KAAK,QAAQ,IAAI,OAAON,KAAK,CAACA,KAAK,KAAK,QAAU,IAChE,IAAI,CAACM,SAAS,KAAK,SAAS,IAAIN,KAAK,CAACA,KAAK,CAACsB,SAAW,IACvD,IAAI,CAAChB,SAAS,KAAK,SAAS,IAAIN,KAAK,CAACA,KAAK,CAACuB,SAAW,IACvD,IAAI,CAACjB,SAAS,KAAK,SAAS,IAAIN,KAAK,CAACA,KAAK,CAACwB,SAAW,IACvD,IAAI,CAAClB,SAAS,KAAK,OAAO,IAAIN,KAAK,CAACA,KAAK,CAACyB,OAAS,IACnD,IAAI,CAACnB,SAAS,KAAK,SAAS,IAAIN,KAAK,CAACA,KAAK,CAAC0B,SAAW,IACvD,IAAI,CAACpB,SAAS,KAAK,SAAS,IAAIN,KAAK,CAACA,KAAK,CAAC2B,SAAW,CACzD,EAAG;MAEH,OAAO3B,KAAK,CAACA,KAAK;IAEnB;IAEA,OAAO,IAAI,CAACK,MAAM,IAAIL,KAAK;EAE5B;EAEA4B,WAAWA,CAAEC,OAAO,EAAG;IAEtB,OAAO,IAAI,CAAC7B,KAAK,IAAI,IAAI,CAACA,KAAK,CAAC8B,MAAM,GAAG,IAAI,CAAC9B,KAAK,CAAC4B,WAAW,CAAEC,OAAQ,CAAC,GAAG,OAAO;EAErF;EAEAE,KAAKA,CAAA,EAAG;IAEP,OAAO,IAAI,CAAC/B,KAAK,IAAI,IAAI,CAACA,KAAK,CAAC8B,MAAM,GAAG,IAAI,CAAC9B,KAAK,GAAGJ,KAAK,CAAC,CAAC;EAE9D;EAEAoC,SAASA,CAAEC,IAAI,EAAG;IAEjB,KAAK,CAACD,SAAS,CAAEC,IAAK,CAAC;IAEvB,IAAK,IAAI,CAACjC,KAAK,KAAK,IAAI,EAAG;MAE1B,IAAK,IAAI,CAACM,SAAS,KAAK,aAAa,EAAG;QAEvC2B,IAAI,CAACjC,KAAK,GAAGR,mBAAmB,CAAE,IAAI,CAACQ,KAAM,CAAC;MAE/C,CAAC,MAAM;QAENiC,IAAI,CAACjC,KAAK,GAAG,IAAI,CAACA,KAAK,GAAG,IAAI,CAACA,KAAK,CAACkC,MAAM,CAAED,IAAI,CAACE,IAAK,CAAC,CAACC,IAAI,GAAG,IAAI;MAErE;IAED,CAAC,MAAM;MAENH,IAAI,CAACjC,KAAK,GAAG,IAAI;IAElB;IAEAiC,IAAI,CAAC3B,SAAS,GAAG,IAAI,CAACA,SAAS;IAC/B2B,IAAI,CAACtB,UAAU,GAAG,IAAI,CAACA,UAAU;EAElC;EAEA0B,WAAWA,CAAEJ,IAAI,EAAG;IAEnB,KAAK,CAACI,WAAW,CAAEJ,IAAK,CAAC;IAEzB,IAAIjC,KAAK,GAAG,IAAI;IAEhB,IAAKiC,IAAI,CAACjC,KAAK,KAAK,IAAI,EAAG;MAE1B,IAAKiC,IAAI,CAAC3B,SAAS,KAAK,aAAa,EAAG;QAEvCN,KAAK,GAAGP,mBAAmB,CAAEwC,IAAI,CAACjC,KAAM,CAAC;MAE1C,CAAC,MAAM,IAAKiC,IAAI,CAAC3B,SAAS,KAAK,SAAS,EAAG;QAE1CN,KAAK,GAAGiC,IAAI,CAACE,IAAI,CAACG,QAAQ,CAAEL,IAAI,CAACjC,KAAK,CAAE;MAEzC,CAAC,MAAM;QAENA,KAAK,GAAGiC,IAAI,CAACE,IAAI,CAACI,KAAK,CAAEN,IAAI,CAACjC,KAAK,CAAE,IAAI,IAAI;MAE9C;IAED;IAEA,IAAI,CAACA,KAAK,GAAGA,KAAK;IAElB,IAAI,CAACM,SAAS,GAAG2B,IAAI,CAAC3B,SAAS;IAC/B,IAAI,CAACK,UAAU,GAAGsB,IAAI,CAACtB,UAAU;EAElC;AAED;AAEA,eAAeb,mBAAmB;AAElC,OAAO,MAAM0C,eAAe,GAAG7C,SAAS,CAAEG,mBAAoB,CAAC;AAE/DJ,cAAc,CAAE,iBAAiB,EAAE8C,eAAgB,CAAC;AAEpDjD,YAAY,CAAE,qBAAqB,EAAEO,mBAAoB,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}